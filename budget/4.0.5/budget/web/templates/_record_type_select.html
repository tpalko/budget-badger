<form id="form-recordtype-{{ record.id }}">
    {% csrf_token %}
    <select data-recordid="{{ record.id }}" name="record_type">                    
        {% for k in record_types %}
            <option value="{{ k }}" {% if k == record.meta_record_type %}selected{% endif %}>{{ k }}</option>
        {% endfor %}
    </select>
</form>

<script language="javascript">

    function handleRecordTypeSelect(e) {
        
        e.preventDefault();
        
        record_id = e.target.dataset.recordid;

        var form = document.querySelector("form#form-recordtype-" + record_id);
        var data = new FormData(form);

        var options = {
            method: "POST",
            body: data
        }

        fetch("{% url "update_record_type" tenant_id=1 record_id=record.id %}", options)
            .then((response) => {
                var responsej = response.json();
                return responsej;
            })
            .then((response) => {
                addErrorMessage(response.message)
                if (!response.success) {
                    e.target.value = response.data.original_record_type;
                }
            })
            .catch((error) => {
                addErrorMessage(error);
                console.error(error);
            });
    }

    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll("select[name='record_type']").forEach(( e, i ) => {
            e.addEventListener('change', handleRecordTypeSelect);  
        });
    });

</script>
