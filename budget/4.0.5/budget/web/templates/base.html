{% load static %}
{% load budget_tags %}

<!doctype html>

<html>
<head>
	<link rel="stylesheet" type="text/css" href="{% static "style/clear.css" %}" />
	<link rel="stylesheet" type="text/css" href="{% static "style/budget.css" %}" />
	<link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}" />
  
</head>
<body>

<div class="header">

	<div class="row">
		<div class="col-3">
			<h1 class="logo">Budget Badger</h1>
		</div>
		<div class="col-13 pull-right">
			<ul class="menu">
				{% for menuitem in menu %}
					{% url menuitem|lookup:"url" tenant_id="1" as this_url %}
					<li class="{% if request.path == this_url %}selected{% endif %}"><a href="{{ this_url }}">{{ menuitem|lookup:"display" }}</a></li>
				{% endfor %}
			</ul>			
		</div>
	</div>
	<div class="row">
		<div>
			<ul class="messages" style="display: none;">
				{% for message in messages %}
				<li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
				{% endfor %}
			</ul>			
		</div>
	</div>
</div>

<div class="content">
	{% block content %}{% endblock %}
</div>

<script type="text/javascript" src="{% static "js/budget.js" %}"></script>

<script language="javascript">

    function handleRecordTypeSelect(e) {
        
        e.preventDefault();
        
        record_id = e.target.dataset.recordid;

        var form = document.querySelector("form#form-recordtype-" + record_id);
        var data = new FormData(form);

        var options = {
            method: "POST",
            body: data
        }

        var base_url = "{% url "update_record_type" tenant_id="000" record_id="111" %}";

        url = base_url.replace(/000/, 1).replace(/111/, record_id);

        fetch(url, options)
            .then((response) => {
                var responsej = response.json();
                return responsej;
            })
            .then((response) => {
                addErrorMessage(response.message)
                if (!response.success) {
                    e.target.value = response.data.original_record_type;
                }
            })
            .catch((error) => {
                addErrorMessage(error);
                console.error(error);
            });
    }

    document.addEventListener('DOMContentLoaded', function() {
		console.log('dom loaded')
        document.querySelectorAll("select[name='record_type']").forEach(( e, i ) => {
			console.log(e);
            e.addEventListener('change', handleRecordTypeSelect);  
        });
    });

</script>

{% block script %}



{% endblock %}

</body>

</html>
